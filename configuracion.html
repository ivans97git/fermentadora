<!DOCTYPE html>
<html>
<head>
    <title>Fermentadora</title>
    <link rel="stylesheet" href="configuracion.styles.css">
        <!-- Carga Paho MQTT primero -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
    <!-- Luego tu script, con defer para esperar a que el DOM est√© listo -->
    <script src="config.script.js" defer></script>
</head>
<body>
    <header>
        <div class="titulo-principal">FERMENTADORA</div>
        <div class="estado-conexion">CONECTADO</div>
    </header>  
    <nav>
        <ul class="menu">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="configuracion.html" class="active">Configuraci√≥n</a></li>
            <li><a href="manualdeuso.html">Manual de uso</a></li>
        </ul>
    </nav>
    <main>
        <h2>CONFIGURACI√ìN</h2>
        <p>Seleccione los par√°metros de funcionamiento que desee para la m√°quina.</p>
        
        <!-- Panel de √∫ltima configuraci√≥n cargada (ahora primero) -->
        <div class="ultimo-valor-panel" id="ultimo-valor-panel">
            <div class="ultimo-valor-title">√öltima Configuraci√≥n Cargada</div>
            <div class="ultimo-valor-content" id="ultimo-valor-content">
                <div class="no-valor">No se han cargado valores a√∫n</div>
            </div>
        </div>
        
        <!-- Panel de configuraci√≥n (ahora segundo) -->
        <div class="config-panel">
            <div class="control-group">
                <label for="temperatura">Temperatura (¬∞C)</label>
                <input type="number" id="temperatura" min="10" max="40" step="0.5" value="22.5">
                <div class="range-info">
                    <span>M√≠n: 10¬∞C</span>
                    <span>M√°x: 40¬∞C</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="humedad">Humedad Relativa (%)</label>
                <input type="number" id="humedad" min="30" max="90" step="1" value="65">
                <div class="range-info">
                    <span>M√≠n: 30%</span>
                    <span>M√°x: 90%</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="tiempo">Tiempo de Operaci√≥n (minutos)</label>
                <input type="number" id="tiempo" min="15" max="4320" step="15" value="1440">
                <div class="range-info">
                    <span>M√≠n: 15 min</span>
                    <span>M√°x: 3 d√≠as (4320 min)</span>
                </div>
                <div class="time-display" id="time-display">Equivalente: 24 horas</div>
            </div>
            
            <div class="button-group">
                <button class="button button-primary" id="cargar">Cargar</button>
                <button class="button button-secondary" id="borrar">Borrar</button>
            </div>
        </div>
    </main>
    <footer>
        <div class="footer-content">
            <div class="contact-info">
                <span class="contact-icon">‚úâ</span>
                <a href="mailto:contacto@fermentadora.com" style="color: white; text-decoration: none;">contacto@fermentadora.com</a>
            </div>
            <div class="contact-info">
                <span class="contact-icon">üì±</span>
                <a href="https://wa.me/521234567890" style="color: white; text-decoration: none;">+52 123 456 7890</a>
            </div>
        </div>
    </footer>

    <script>
        // Valores por defecto
        const valoresPorDefecto = {
            temperatura: 22.5,
            humedad: 65,
            tiempo: 1440 // 24 horas en minutos
        };

        // Variable para almacenar el √∫ltimo valor cargado
        let ultimoValorCargado = JSON.parse(localStorage.getItem('ultimoValorFermentadora')) || null;

        // Variables globales para los valores de configuraci√≥n
        let configTemperatura = valoresPorDefecto.temperatura;
        let configHumedad = valoresPorDefecto.humedad;
        let configTiempo = valoresPorDefecto.tiempo;

        // Funci√≥n para convertir minutos a formato legible
        function formatMinutes(minutes) {
            const days = Math.floor(minutes / 1440);
            const hours = Math.floor((minutes % 1440) / 60);
            const mins = minutes % 60;
            
            let result = [];
            if (days > 0) result.push(`${days} d√≠a${days > 1 ? 's' : ''}`);
            if (hours > 0) result.push(`${hours} hora${hours > 1 ? 's' : ''}`);
            if (mins > 0 || result.length === 0) result.push(`${mins} minuto${mins !== 1 ? 's' : ''}`);
            
            return result.join(' ');
        }

        // Funci√≥n para formatear fecha
        function formatFecha(fecha) {
            const opciones = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return fecha.toLocaleDateString('es-ES', opciones);
        }

        // Actualizar display de tiempo
        function updateTimeDisplay() {
            const minutes = parseInt(document.getElementById('tiempo').value) || 0;
            document.getElementById('time-display').textContent = `Equivalente: ${formatMinutes(minutes)}`;
        }

        // Mostrar √∫ltimo valor cargado
        function mostrarUltimoValor() {
            const container = document.getElementById('ultimo-valor-content');
            
            if (!ultimoValorCargado) {
                container.innerHTML = '<div class="no-valor">No se han cargado valores a√∫n</div>';
                return;
            }
            
            const fecha = new Date(ultimoValorCargado.fecha);
            
            container.innerHTML = `
                <div class="ultimo-valor-item">
                    <div class="ultimo-valor-label">Temperatura</div>
                    <div class="ultimo-valor-dato">${ultimoValorCargado.temperatura}¬∞C</div>
                </div>
                <div class="ultimo-valor-item">
                    <div class="ultimo-valor-label">Humedad</div>
                    <div class="ultimo-valor-dato">${ultimoValorCargado.humedad}%</div>
                </div>
                <div class="ultimo-valor-item">
                    <div class="ultimo-valor-label">Tiempo</div>
                    <div class="ultimo-valor-dato">${formatMinutes(ultimoValorCargado.tiempo)}</div>
                </div>
                <div class="ultimo-valor-fecha">Cargado: ${formatFecha(fecha)}</div>
            `;
        }

        // Funci√≥n para actualizar las variables de configuraci√≥n
        function actualizarVariablesConfiguracion() {
            configTemperatura = parseFloat(document.getElementById('temperatura').value) || valoresPorDefecto.temperatura;
            configHumedad = parseInt(document.getElementById('humedad').value) || valoresPorDefecto.humedad;
            configTiempo = parseInt(document.getElementById('tiempo').value) || valoresPorDefecto.tiempo;
            
            console.log('Variables actualizadas:', {
                temperatura: configTemperatura,
                humedad: configHumedad,
                tiempo: configTiempo
            });
        }

        // Inicializar display de tiempo y mostrar √∫ltimo valor
        updateTimeDisplay();
        mostrarUltimoValor();

        // Escuchar cambios en el input de tiempo
        document.getElementById('tiempo').addEventListener('input', updateTimeDisplay);

        // Bot√≥n Borrar
        document.getElementById('borrar').addEventListener('click', function() {
            document.getElementById('temperatura').value = valoresPorDefecto.temperatura;
            document.getElementById('humedad').value = valoresPorDefecto.humedad;
            document.getElementById('tiempo').value = valoresPorDefecto.tiempo;
            updateTimeDisplay();
            actualizarVariablesConfiguracion(); // Actualizar variables al borrar
            alert('Valores restablecidos a los predeterminados');
        });

        // Bot√≥n Cargar
        document.getElementById('cargar').addEventListener('click', function() {
            // Actualizar las variables primero
            actualizarVariablesConfiguracion();
            
            // Crear nuevo objeto con los valores
            ultimoValorCargado = {
                temperatura: configTemperatura,
                humedad: configHumedad,
                tiempo: configTiempo,
                fecha: new Date().toISOString()
            };
            
            // Guardar en localStorage
            localStorage.setItem('ultimoValorFermentadora', JSON.stringify(ultimoValorCargado));
            
            // Mostrar confirmaci√≥n
            alert(`Configuraci√≥n cargada:\nTemperatura: ${configTemperatura}¬∞C\nHumedad: ${configHumedad}%\nTiempo: ${formatMinutes(configTiempo)}`);
            
            // Actualizar panel de √∫ltimo valor
            mostrarUltimoValor();
            
            // Aqu√≠ puedes usar las variables configTemperatura, configHumedad y configTiempo
            // para enviarlas a tu backend o hacer lo que necesites con ellas
            console.log('Configuraci√≥n cargada:', {
                temperatura: configTemperatura,
                humedad: configHumedad,
                tiempo: configTiempo
            });
        });

        // Tambi√©n puedes llamar a actualizarVariablesConfiguracion() cuando cambie cualquier campo
        document.getElementById('temperatura').addEventListener('change', actualizarVariablesConfiguracion);
        document.getElementById('humedad').addEventListener('change', actualizarVariablesConfiguracion);
        document.getElementById('tiempo').addEventListener('change', actualizarVariablesConfiguracion);
    </script>
</body>
</html>
